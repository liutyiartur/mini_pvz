<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Mini PvZ</title>
    <style>
        html, body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background: black;
            font-family: Arial;
        }

        #ui {
            position: fixed;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.8);
            padding: 6px;
            border-radius: 8px;
            display: none;
        }

        button {
            margin: 2px;
            padding: 6px 10px
        }

        .active {
            background: #ffb703
        }

        #sun {
            text-align: center;
            font-weight: bold
        }

        canvas {
            display: block
        }
    </style>
</head>
<body>

<div id="ui">
    <button onclick="selectPlant('pea')">üå± –ì–æ—Ä–æ—Ö (50)</button>
    <button onclick="selectPlant('sun')">üåª –ü–æ–¥—Å–æ–ª–Ω—É—Ö (25)</button>
    <button onclick="selectPlant('nut')">ü•ú –û—Ä–µ—Ö (25)</button>
    <button id="shovelBtn" onclick="selectShovel()">ü™ì –õ–æ–ø–∞—Ç–∞</button>
    <div id="sun">–°–æ–ª–Ω—Ü–∞: 100</div>
</div>

<canvas id="c"></canvas>

<script>
    const c = document.getElementById("c");
    const ctx = c.getContext("2d");

    function resize() {
        c.width = innerWidth;
        c.height = innerHeight;
    }

    window.onresize = resize;
    resize();

    const rows = 3, cols = 7;
    let cellW, cellH;

    let mode = "menu";
    let sun, plants, zombies, bullets, suns, lawnmowers;
    let selectedPlant = null, shovel = false;
    let tick;

    function resetGame() {
        cellW = c.width / cols;
        cellH = c.height / rows;
        sun = 100;
        plants = [];
        zombies = [];
        bullets = [];
        suns = [];
        lawnmowers = [];
        selectedPlant = null;
        shovel = false;
        tick = 0;

        for (let r = 0; r < rows; r++) {
            lawnmowers.push({row: r, x: -40, active: true});
        }
    }

    // ===== –ú–ï–ù–Æ =====
    function drawMenu() {
        ctx.clearRect(0, 0, c.width, c.height);

        let g = ctx.createLinearGradient(0, 0, 0, c.height);
        g.addColorStop(0, "#87ceeb");
        g.addColorStop(1, "#7ec850");
        ctx.fillStyle = g;
        ctx.fillRect(0, 0, c.width, c.height);

        ctx.fillStyle = "white";
        ctx.textAlign = "center";
        ctx.font = "bold 48px Arial";
        ctx.fillText("PLANTS vs ZOMBIES", c.width / 2, c.height / 2 - 80);

        ctx.fillStyle = "#5a8f2f";
        ctx.fillRect(c.width / 2 - 150, c.height / 2 - 20, 300, 70);
        ctx.strokeStyle = "#2f6f2f";
        ctx.lineWidth = 4;
        ctx.strokeRect(c.width / 2 - 150, c.height / 2 - 20, 300, 70);

        ctx.fillStyle = "white";
        ctx.font = "bold 32px Arial";
        ctx.fillText("ADVENTURE", c.width / 2, c.height / 2 + 30);
    }

    c.onclick = e => {
        const r = c.getBoundingClientRect();
        const x = e.clientX - r.left;
        const y = e.clientY - r.top;

        if (mode === "menu") {
            if (
                x > c.width / 2 - 150 && x < c.width / 2 + 150 &&
                y > c.height / 2 - 20 && y < c.height / 2 + 50
            ) {
                mode = "game";
                document.getElementById("ui").style.display = "block";
                resetGame();
            }
            return;
        }

        suns.forEach((s, i) => {
            if (Math.hypot(s.x - x, s.y - y) < 15) {
                sun += 25;
                suns.splice(i, 1);
            }
        });

        const col = Math.floor(x / cellW);
        const row = Math.floor(y / cellH);

        if (shovel) {
            const i = plants.findIndex(p => p.row === row && p.col === col);
            if (i != -1) plants.splice(i, 1);
            shovel = false;
            shovelBtn.classList.remove("active");
            return;
        }

        if (!selectedPlant) return;
        if (plants.some(p => p.row === row && p.col === col)) return;

        const cost = {pea: 50, sun: 25, nut: 25}[selectedPlant];
        if (sun < cost) return;

        plants.push({row, col, type: selectedPlant, hp: selectedPlant === "nut" ? 20 : 3, cd: 0});
        sun -= cost;
        selectedPlant = null;
    };

    function selectPlant(t) {
        selectedPlant = t;
        shovel = false;
        shovelBtn.classList.remove("active");
    }

    function selectShovel() {
        shovel = true;
        selectedPlant = null;
        shovelBtn.classList.add("active");
    }

    // ===== –ò–ì–†–ê =====
    function spawnZombie() {
        zombies.push({
            row: Math.floor(Math.random() * rows),
            x: c.width + 30,
            hp: 10
        });
    }

    function update() {
        tick++;

        if (tick % 200 === 0) spawnZombie();
        if (tick % 300 === 0) suns.push({x: Math.random() * c.width, y: -20});

        plants.forEach(p => {
            if (p.type === "sun" && tick % 300 === 0) {
                suns.push({x: p.col * cellW + cellW / 2, y: p.row * cellH + 20});
            }
            if (p.type === "pea" && tick % 60 === 0 && zombies.some(z => z.row === p.row)) {
                bullets.push({x: p.col * cellW + cellW * 0.7, row: p.row});
            }
        });

        bullets.forEach(b => b.x += 5);
        suns.forEach(s => s.y += 0.6);
        zombies.forEach(z => {
            z.x -= 0.4;
            bullets.forEach((b, i) => {
                if (z.row === b.row && Math.abs(z.x - b.x) < 12) {
                    z.hp--;
                    bullets.splice(i, 1);
                }
            });
        });

        zombies = zombies.filter(z => z.hp > 0);
    }

    // ===== –†–ò–°–û–í–ê–ù–ò–ï =====
    function draw() {
        ctx.clearRect(0, 0, c.width, c.height);

        // —Å–µ—Ç–∫–∞
        ctx.strokeStyle = "rgba(0,0,0,0.2)";
        for (let i = 0; i <= rows; i++) {
            ctx.beginPath();
            ctx.moveTo(0, i * cellH);
            ctx.lineTo(c.width, i * cellH);
            ctx.stroke();
        }
        for (let i = 0; i <= cols; i++) {
            ctx.beginPath();
            ctx.moveTo(i * cellW, 0);
            ctx.lineTo(i * cellW, c.height);
            ctx.stroke();
        }

        // —Ä–∞—Å—Ç–µ–Ω–∏—è
        plants.forEach(p => {
            const cx = p.col * cellW + cellW / 2;
            const cy = p.row * cellH + cellH / 2;

            if (p.type === "pea") {
                ctx.fillStyle = "#2f8f2f";
                ctx.beginPath();
                ctx.arc(cx, cy, 14, 0, Math.PI * 2);
                ctx.fill();
            }

            if (p.type === "sun") { // –°–¢–ê–†–´–ô –ü–û–î–°–û–õ–ù–£–•
                ctx.fillStyle = "#ffd93b";
                ctx.beginPath();
                ctx.arc(cx, cy, 20, 0, Math.PI * 2);
                ctx.fill();
                ctx.fillStyle = "#a86b00";
                ctx.beginPath();
                ctx.arc(cx, cy, 10, 0, Math.PI * 2);
                ctx.fill();
            }

            if (p.type === "nut") {
                ctx.fillStyle = "#8b5a2b";
                ctx.fillRect(cx - 16, cy - 16, 32, 32);
            }
        });

        // –∑–æ–º–±–∏
        zombies.forEach(z => {
            const zy = z.row * cellH + cellH / 2;
            ctx.fillStyle = "#4f6f2f";
            ctx.beginPath();
            ctx.arc(z.x, zy, 18, 0, Math.PI * 2);
            ctx.fill();

            // –≥–ª–∞–∑–∞
            ctx.fillStyle = "white";
            ctx.beginPath();
            ctx.arc(z.x + 5, zy - 4, 5, 0, Math.PI * 2);
            ctx.fill();
            ctx.fillStyle = "black";
            ctx.beginPath();
            ctx.arc(z.x + 6, zy - 4, 2, 0, Math.PI * 2);
            ctx.fill();

            // —Ä–æ—Ç
            ctx.fillRect(z.x - 8, zy + 8, 16, 4);
        });

        bullets.forEach(b => {
            ctx.fillStyle = "yellow";
            ctx.beginPath();
            ctx.arc(b.x, b.row * cellH + cellH / 2, 4, 0, Math.PI * 2);
            ctx.fill();
        });

        suns.forEach(s => {
            ctx.fillStyle = "orange";
            ctx.beginPath();
            ctx.arc(s.x, s.y, 12, 0, Math.PI * 2);
            ctx.fill();
        });

        sunDiv.innerText = "–°–æ–ª–Ω—Ü–∞: " + sun;
    }

    const sunDiv = document.getElementById("sun");
    const shovelBtn = document.getElementById("shovelBtn");

    (function loop() {
        if (mode === "menu") drawMenu();
        else {
            update();
            draw();
        }
        requestAnimationFrame(loop);
    })();
</script>
</body>
</html>
